
  <html>
    <head>
      <title>Hello there</title>
      <link rel="stylesheet" href="./styles.css">
    </head>
    <body>
      <a class='back-button' href='/'>Back to Home</a>
      <div class='markdown-body'>
        <h1 id="android-pay-on-chrome">Android Pay on Chrome</h1>
<p><a href="https://paymentrequestguide.firebaseapp.com">See live code samples</a></p>
<p>The following guide outlines how to implement Android Pay</p>
<h2 id="review-requirements">Review Requirements</h2>
<ul>
<li>Android Pay is available to customers in the following countries: US / UK / AU / SG</li>
<li>Review the Android Pay detailed <a href="https://support.google.com/payments/merchant/answer/75724?payments_to_biz=&amp;rd=1">content policies</a> to make sure your specific goods or services are supported.</li>
<li>Your <a href="https://developers.google.com/android-pay/#processors">payment processor</a> needs to support Android Pay tokens.</li>
<li>For testing, you need to <a href="https://support.google.com/androidpay/answer/6289372?hl=en&amp;ref_topic=6224823">add a card</a> to Android Pay on your test device.</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<ul>
<li>Sign up for a merchant ID from Android Pay -<ul>
<li>Add your company, site origin and a company email to the <a href="https://goo.gl/forms/SiKd7GAESCPNg9H83">following form</a></li>
<li>Google will provide a merchant ID within 24 hours.</li>
</ul>
</li>
<li>Download the latest version of <a href="https://play.google.com/store/apps/details?id=com.chrome.dev">Chrome Dev</a> for Android.</li>
<li>Because Android Pay in Chrome utilizes the PaymentRequest API, it is essential that you familiarize yourself with the <a href="https://developers.google.com/web/fundamentals/primers/payment-request/?hl=en">integration guide</a> prior to continuing.</li>
<li>Work through the demo to get acquainted with the PaymentRequest API.</li>
<li>Even if you are not an Android developer, it will be useful to acquaint yourself with the <a href="https://developers.google.com/android-pay/android/tutorial">Android Pay in-app APIs</a>.  Because the responses returned by Android Pay are the same on Android &amp; Chrome, the information on response handling is useful.</li>
</ul>
<h2 id="get-started-with-android-pay-in-test-mode">Get started with Android Pay in Test Mode</h2>
<p>Any site can begin testing with Android Pay in test mode.</p>
<ol>
<li><p>We&#39;ll start with the <a href="https://github.com/asieke/prguide/blob/master/public/credit_cards.html">basic implementation of PaymentRequest</a> that accepts credit cards</p>
</li>
<li><p>We’ll be modifying the supportedInstruments object within the PaymentRequest in order to let Chrome know that the website supports Android Pay</p>
<pre><code class="hljs language-javascript">  <span class="hljs-keyword">var</span> supportedInstruments = [{
      <span class="hljs-attr">supportedMethods</span>: [<span class="hljs-string">&#x27;amex&#x27;</span>, <span class="hljs-string">&#x27;discover&#x27;</span>,<span class="hljs-string">&#x27;mastercard&#x27;</span>,<span class="hljs-string">&#x27;visa&#x27;</span>]
    }
  ];
</code></pre>
</li>
<li><p>Add “android.com/pay” to the above supportedInstruments object</p>
<pre><code class="hljs language-javascript">  <span class="hljs-keyword">var</span> supportedInstruments = [
    {
      <span class="hljs-attr">supportedMethods</span>: [<span class="hljs-string">&#x27;amex&#x27;</span>, <span class="hljs-string">&#x27;discover&#x27;</span>,<span class="hljs-string">&#x27;mastercard&#x27;</span>,<span class="hljs-string">&#x27;visa&#x27;</span>]
    },
    <span class="hljs-comment">//add android pay instrument details</span>
    {
      <span class="hljs-attr">supportedMethods</span>: [<span class="hljs-string">&#x27;https://android.com/pay&#x27;</span>],
      <span class="hljs-attr">data</span>: {
        <span class="hljs-attr">environment</span>: <span class="hljs-string">&#x27;TEST&#x27;</span>,
        <span class="hljs-attr">allowedCardNetworks</span>: [<span class="hljs-string">&#x27;AMEX&#x27;</span>, <span class="hljs-string">&#x27;MASTERCARD&#x27;</span>, <span class="hljs-string">&#x27;VISA&#x27;</span>, <span class="hljs-string">&#x27;DISCOVER&#x27;</span>],
        <span class="hljs-attr">paymentMethodTokenizationParameters</span>: {
          <span class="hljs-attr">tokenizationType</span>: <span class="hljs-string">&#x27;NETWORK_TOKEN&#x27;</span>,
          <span class="hljs-attr">parameters</span>: {
            <span class="hljs-string">&#x27;publicKey&#x27;</span>: <span class="hljs-string">&#x27;BC9u7amr4kFD8qsdxnEfWV7RPDR9v4gLLkx3jfyaGOvxBoEuLZKE0Tt5O/2jMMxJ9axHpAZD2Jhi4E74nqxr944=&#x27;</span>
          }
        }
      }
    }
  ];
</code></pre>
</li>
<li><p>Let’s walk through the above parameters in a bit more details</p>
<ul>
<li>supportedMethods [&#39;<a href="https://android.com/pay&#39;%5D">https://android.com/pay&#39;]</a> - represents Android Pay’s payment app identifier; this must be specified exactly in order for Android Pay to work</li>
<li>environment: ‘TEST’ - specifies that you will be calling the Android Pay test environment</li>
<li>allowedCardNetworks: [&#39;...&#39;] - specifies which card networks constitute a valid Android Pay response</li>
<li>paymentMethodTokenizationParameters: {} - for now leave this as NETWORK_TOKEN and add your own public key to encrypt the response.  (See: <a href="https://developers.google.com/android-pay/integration/gateway-processor-integration#retrieving-the-encrypted-payload">How to generate encryption keys</a>).</li>
</ul>
</li>
<li><p>Once you add the Android Pay object, Chrome can now request Android Pay tokens on your behalf.  The completed code should produce the following UI:</p>
<ul>
<li>The response from PaymentRequest will contain the shipping and contact information as in the examples outlined in the <a href="https://developers.google.com/web/fundamentals/primers/payment-request/?hl=en">PaymentRequest integration guide</a> but now includes an additional response from Android Pay containing</li>
<li>Billing address information</li>
<li>Information about the payment instrument</li>
<li>Details about the Payment token</li>
</ul>
</li>
<li><p>Putting it all together - <a href="https://github.com/asieke/prguide/blob/master/public/tutorial.html">see the completed code example</a></p>
</li>
</ol>
<h2 id="request-a-network-token">Request a Network Token</h2>
<p>Now that we have a working prototype that utilizes the Android Pay test environment, it is just a few changes to start requesting network tokens.  Requesting a Network token requires 2 pieces of information to be included in the PaymentRequest.</p>
<ul>
<li>A Merchant ID that maps to your origin</li>
<li>A public key used to encrypt the response from Android Pay</li>
</ul>
<ol>
<li><p>Sign up for a merchant ID from Android Pay -</p>
<ul>
<li>Add your company, site origin and a company email to the <a href="https://goo.gl/forms/SiKd7GAESCPNg9H83">following form</a></li>
<li>Google will provide a merchant ID within 24 hours.</li>
</ul>
</li>
<li><p>Acquire a key-pair used to encrypt the response from Android Pay</p>
<ul>
<li>Google recommends you work with your payment processor to obtain a public key.  This simplifies the process as your processor will be able to handle decryption of the Android Pay Payload.  Contact your payment processor for more information.</li>
<li>If you want to handle encryption yourself, Please refer to the following guide for generating a base64 encoded Elliptic Curve Integrated Encryption key</li>
</ul>
</li>
<li><p>Modify the TEST environment request to request an Android Pay token</p>
<pre><code class="hljs language-javascript">  <span class="hljs-keyword">var</span> supportedInstruments = [
    {
      <span class="hljs-attr">supportedMethods</span>: [<span class="hljs-string">&#x27;amex&#x27;</span>, <span class="hljs-string">&#x27;discover&#x27;</span>,<span class="hljs-string">&#x27;mastercard&#x27;</span>,<span class="hljs-string">&#x27;visa&#x27;</span>]
    },
    {
      <span class="hljs-attr">supportedMethods</span>: [<span class="hljs-string">&#x27;https://android.com/pay&#x27;</span>],
      <span class="hljs-attr">data</span>: {
        <span class="hljs-comment">//merchant ID obtained from Google that maps to your origin</span>
        <span class="hljs-attr">merchantId</span>: <span class="hljs-string">&#x27;02510116604241796260&#x27;</span>,
        <span class="hljs-attr">allowedCardNetworks</span>: [<span class="hljs-string">&#x27;AMEX&#x27;</span>, <span class="hljs-string">&#x27;MASTERCARD&#x27;</span>, <span class="hljs-string">&#x27;VISA&#x27;</span>, <span class="hljs-string">&#x27;DISCOVER&#x27;</span>],
        <span class="hljs-attr">paymentMethodTokenizationParameters</span>: {
          <span class="hljs-attr">tokenizationType</span>: <span class="hljs-string">&#x27;NETWORK_TOKEN&#x27;</span>,
          <span class="hljs-attr">parameters</span>: {
            <span class="hljs-comment">//public key to encrypt response from Android Pay</span>
            <span class="hljs-string">&#x27;publicKey&#x27;</span>: <span class="hljs-string">&#x27;BC9u7amr4kFD8qsdxnEfWV7RPDR9v4gLLkx3jfyaGOvxBoEuLZKE0Tt5O/2jMMxJ9axHpAZD2Jhi4E74nqxr944=&#x27;</span>
          }
        }
      }
    }
  ];
</code></pre>
</li>
<li><p>The UI and response should have the same format as in the TEST mode example</p>
</li>
<li><p>Putting it all together - <a href="https://github.com/asieke/prguide/blob/master/public/android_pay_network.html">see the completed code example</a></p>
</li>
</ol>
<h4 id="request-a-gateway-token">Request a Gateway Token</h4>
<p>The following example outlines how to request a token directly from your payment gateway.  In this example we outline how to request a stripe token.  If you use Braintree or Vantiv please contact your processor for more detailed instructions.</p>
<p>In requesting a gateway token, you eliminate a network call to your gateway as in the Network model above.  Instead, Android Pay makes a call to your processor on your behalf and returns a chargeable gateway token.</p>
<ol>
<li><p>Use the same <a href="https://goo.gl/forms/SiKd7GAESCPNg9H83">Android Pay Merchant ID</a></p>
</li>
<li><p>You do not need to utilize encryption in order to request a Gateway token.</p>
</li>
<li><p>Modify the Android Pay request to include your gateway parameters</p>
<pre><code class="hljs language-javascript">  <span class="hljs-keyword">var</span> supportedInstruments = [
    {
      <span class="hljs-attr">supportedMethods</span>: [<span class="hljs-string">&#x27;amex&#x27;</span>, <span class="hljs-string">&#x27;discover&#x27;</span>,<span class="hljs-string">&#x27;mastercard&#x27;</span>,<span class="hljs-string">&#x27;visa&#x27;</span>]
    },
    {
      <span class="hljs-attr">supportedMethods</span>: [<span class="hljs-string">&#x27;https://android.com/pay&#x27;</span>],
      <span class="hljs-attr">data</span>: {
        <span class="hljs-comment">//merchant ID obtained from Google that maps to your origin</span>
        <span class="hljs-attr">merchantId</span>: <span class="hljs-string">&#x27;02510116604241796260&#x27;</span>,
        <span class="hljs-attr">allowedCardNetworks</span>: [<span class="hljs-string">&#x27;AMEX&#x27;</span>, <span class="hljs-string">&#x27;MASTERCARD&#x27;</span>, <span class="hljs-string">&#x27;VISA&#x27;</span>, <span class="hljs-string">&#x27;DISCOVER&#x27;</span>],
        <span class="hljs-attr">paymentMethodTokenizationParameters</span>: {
          <span class="hljs-attr">tokenizationType</span>: <span class="hljs-string">&#x27;GATEWAY_TOKEN&#x27;</span>,
          <span class="hljs-attr">parameters</span>: {
            <span class="hljs-string">&#x27;gateway&#x27;</span>: <span class="hljs-string">&#x27;stripe&#x27;</span>,
            <span class="hljs-comment">// Place your own Stripe publishable key here.</span>
            <span class="hljs-string">&#x27;stripe:publishableKey&#x27;</span>: <span class="hljs-string">&#x27;pk_live_fD7ggZCtrB0vJNApRX5TyJ9T&#x27;</span>,
            <span class="hljs-string">&#x27;stripe:version&#x27;</span>: <span class="hljs-string">&#x27;2016-07-06&#x27;</span>
          }
        }
      }
    }
  ];
</code></pre>
</li>
<li><p>The response from Chrome/Android Pay now includes a chargeable gateway token in addition to the same billing and contact information provided in the previous examples.</p>
</li>
<li><p>Putting it all together - <a href="https://github.com/asieke/prguide/blob/master/public/android_pay_gateway.html">see the completed code example</a></p>
</li>
</ol>

      </div>
    </body>
  </html>
  